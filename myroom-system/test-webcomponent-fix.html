<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyRoom WebComponent - API Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .controls h3 {
            margin-top: 0;
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .status {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        my-room-scene {
            display: block;
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MyRoom WebComponent - API Fix Test</h1>
        <p>This test demonstrates that API calls no longer trigger full scene reloads.</p>
        
        <div class="controls">
            <h3>Test Controls</h3>
            
            <div class="button-group">
                <button onclick="loadTestItems()">Load Test Items (Should NOT reload scene)</button>
                <button onclick="changeAvatarConfig()">Change Avatar (Should NOT reload scene)</button>
                <button onclick="resetCamera()">Reset Camera</button>
            </div>
            
            <div class="button-group">
                <button onclick="changeRoom()">Change Room (WILL reload scene - expected)</button>
                <button onclick="changeGender()">Change Gender (WILL reload scene - expected)</button>
            </div>
            
            <div class="status" id="status">
                Ready to test. Watch the console for reload indicators.
            </div>
        </div>
        
        <my-room-scene 
            id="myRoomScene"
            width="100%" 
            height="600"
            room="{\"id\":\"room1\",\"name\":\"Test Room\"}"
            gender="male"
            avatar-config="{\"hair\":\"hair1\",\"top\":\"shirt1\",\"bottom\":\"pants1\"}"
            loaded-items="[]"
            gizmo-mode="false"
            enable-controls="true"
            camera-controls="true">
        </my-room-scene>
    </div>

    <script src="./dist/myroom-webcomponent.umd.js"></script>
    <script>
        let itemCounter = 0;
        let avatarCounter = 0;
        
        function updateStatus(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.textContent = `[${timestamp}] ${message}`;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function loadTestItems() {
            itemCounter++;
            const testItems = [
                {
                    id: `item_${itemCounter}`,
                    name: `Test Item ${itemCounter}`,
                    position: { x: Math.random() * 4 - 2, y: 0, z: Math.random() * 4 - 2 },
                    rotation: { x: 0, y: Math.random() * Math.PI * 2, z: 0 },
                    scale: { x: 1, y: 1, z: 1 }
                }
            ];
            
            const scene = document.getElementById('myRoomScene');
            scene.loadItems(testItems);
            updateStatus(`Loaded test items (count: ${itemCounter}) - Scene should NOT reload`);
        }
        
        function changeAvatarConfig() {
            avatarCounter++;
            const configs = [
                { hair: 'hair1', top: 'shirt1', bottom: 'pants1' },
                { hair: 'hair2', top: 'shirt2', bottom: 'pants2' },
                { hair: 'hair3', top: 'shirt3', bottom: 'pants3' }
            ];
            
            const config = configs[avatarCounter % configs.length];
            const scene = document.getElementById('myRoomScene');
            scene.changeAvatar(config);
            updateStatus(`Changed avatar config (${JSON.stringify(config)}) - Scene should NOT reload`);
        }
        
        function resetCamera() {
            const scene = document.getElementById('myRoomScene');
            scene.resetCamera();
            updateStatus('Reset camera - Scene should NOT reload');
        }
        
        function changeRoom() {
            const rooms = [
                { id: 'room1', name: 'Test Room' },
                { id: 'room2', name: 'Office Room' },
                { id: 'room3', name: 'Living Room' }
            ];
            
            const currentRoom = JSON.parse(document.getElementById('myRoomScene').getAttribute('room') || '{}');
            const nextRoomIndex = (rooms.findIndex(r => r.id === currentRoom.id) + 1) % rooms.length;
            const nextRoom = rooms[nextRoomIndex];
            
            const scene = document.getElementById('myRoomScene');
            scene.setAttribute('room', JSON.stringify(nextRoom));
            updateStatus(`Changed room to ${nextRoom.name} - Scene WILL reload (expected behavior)`);
        }
        
        function changeGender() {
            const scene = document.getElementById('myRoomScene');
            const currentGender = scene.getAttribute('gender');
            const newGender = currentGender === 'male' ? 'female' : 'male';
            
            scene.setAttribute('gender', newGender);
            updateStatus(`Changed gender to ${newGender} - Scene WILL reload (expected behavior)`);
        }
        
        // Monitor for scene reloads by listening to component events
        document.getElementById('myRoomScene').addEventListener('scene-initialized', () => {
            updateStatus('ðŸ”„ SCENE RELOADED - Component was reinitialized');
        });
        
        // Initial status
        updateStatus('WebComponent loaded and ready for testing');
    </script>
</body>
</html>